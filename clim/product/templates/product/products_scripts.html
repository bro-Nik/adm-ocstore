<script>
  // Actions
  $('body').on("click", '.action-confirmation', function () {
    var $modal = $('#ModalConfirmation');
    var $btn = $modal.find('.action');
    $modal.find('.modal-title').text($(this).attr('data-title'));
    $btn.attr('data-action', $(this).attr('data-action'));

    var $form = $(this).closest('form');
    $btn.attr('data-form', '#' + $form.attr('id'));

    $modal.modal('show');
  })


  // Modals

  // Open Modal Movement
  $('.show-movement').on("click", function () {
    var $modal = $('#FullScreenModal');
    // preloader
    $modal.find('.modal-body').load("");

    // page
    var url = "";
    var movement_id = $(this).closest("tr").attr('data-movement-id');
    if (movement_id) {
      url += '?movement_id=' + movement_id;
    }
    $modal.find('.modal-body').load(url);
    $modal.modal('toggle')
  })

  // Open Full Screen Modal
  $('.modal').on('shown.bs.modal', function () {
    var $modal = $(this);
    if (!$modal.find('.modal-fullscreen').length) {
      return false;
    }
    $modal.css('height', $(window).height())
    var $active_modals = $('body').find('.modal.show');
    if ($active_modals.length === 1) {
      return false;
    }
    var $modal = $(this);
    var z_index = $modal.css('z-index');

    $active_modals.each(function () {
      if ($(this).index() !== $modal.index()) {
        var this_z_index = parseInt($(this).css('z-index'));
        if (this_z_index > z_index) {
          z_index = this_z_index;
        }
        var $close_btn = $(this).find('.modal-close-label')
        $close_btn.css('top', '+=60')
        $close_btn.css('opacity', '50%')
      }

    });
    $modal.css('z-index', z_index + 1)
  })

  // Close Full Screen Modal
  $('.modal').on('hide.bs.modal', function () {
    var $modal = $(this);

    if (!$modal.find('.modal-fullscreen').length) {
      return true;
    }
    if (!$('.modal.show').length > 1) {
      return false;
    }
    var z_index = parseInt($modal.css('z-index'));
    var max_z_index = 0;

    $('body').find('.modal.show').each(function () {
      var this_z_index = parseInt($(this).css('z-index'));
      if (this_z_index !== z_index && this_z_index > max_z_index) {
        max_z_index = this_z_index;
      }
    });

    $('body').find('.modal.show').each(function () {
      if ($(this).index() !== $modal.index()) {
        var $close_btn = $(this).find('.modal-close-label')
        $close_btn.css('top', '-=60')
      }

      var this_z_index = parseInt($(this).css('z-index'));
      if (this_z_index == max_z_index) {
        $close_btn.css('opacity', '1')
      }
    });
  })

</script>
